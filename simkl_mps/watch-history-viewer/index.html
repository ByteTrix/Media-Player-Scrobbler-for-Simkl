<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIMKL Watch History | Media Player Scrobbler</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css" />
    <!-- Data script is auto-generated by the app -->
    <script src="data.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <h1><i class="ph ph-clock-counter-clockwise"></i> SIMKL Watch History</h1>
            <div class="header-actions">
                <button class="control-btn theme-toggle" id="theme-toggle" title="Toggle Theme"> <!-- Added control-btn class -->
                    <i class="ph ph-moon"></i>
                </button>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div id="loading-indicator" class="loading-state">
            <div class="spinner"></div>
            <p>Loading your watch history...</p>
        </div>
        
        <!-- Controls now appear first -->
        <div class="controls">
            <div class="search-box">
                <input type="text" id="search-input" placeholder="Search titles, genres, actors...">
                <i class="ph ph-magnifying-glass"></i>
            </div>
            
            <div class="filter-controls">
                <select id="filter-type">
                    <option value="all">All Types</option>
                    <option value="movie">Movies</option>
                    <option value="tv">TV Shows</option>
                    <option value="anime">Anime</option>
                </select>
                
                <select id="filter-year">
                    <option value="all">All Years</option>
                    <!-- Years will be populated via JavaScript -->
                </select>
                
                <select id="sort-by">
                    <option value="watched_at">Recent First</option>
                    <option value="title">Title (A-Z)</option>
                    <option value="year">Release Year</option>
                    <option value="runtime">Runtime</option>
                    <option value="rating">Rating</option>
                </select>

                <button class="control-btn toggle-view" id="view-toggle" title="Toggle View"> <!-- Added control-btn class -->
                    <i class="ph ph-list"></i> <!-- Default: List view icon -->
                </button>

                <button class="control-btn toggle-stats" id="stats-toggle" title="Toggle Statistics"> <!-- Added control-btn class -->
                    <i class="ph ph-chart-pie-slice"></i> <!-- Changed Icon -->
                </button>
            </div>
        </div>
        
        <!-- Dashboard now appears after controls -->
        <div class="dashboard" id="dashboard">
            <div class="stats-panel">
                <div class="stat-card total-watched">
                    <div class="stat-icon"><i class="ph ph-film-slate"></i></div>
                    <div class="stat-content">
                        <span class="stat-value" id="total-count">0</span>
                        <span class="stat-label">Total Watched</span>
                    </div>
                </div>
                <div class="stat-card movies-count">
                    <div class="stat-icon"><i class="ph ph-film-strip"></i></div>
                    <div class="stat-content">
                        <span class="stat-value" id="movies-count">0</span>
                        <span class="stat-label">Movies</span>
                    </div>
                </div>
                <div class="stat-card shows-count">
                    <div class="stat-icon"><i class="ph ph-television"></i></div>
                    <div class="stat-content">
                        <span class="stat-value" id="shows-count">0</span>
                        <span class="stat-label">TV Shows</span>
                    </div>
                </div>
                <div class="stat-card anime-count">
                    <div class="stat-icon"><i class="ph ph-star"></i></div>
                    <div class="stat-content">
                        <span class="stat-value" id="anime-count">0</span>
                        <span class="stat-label">Anime</span>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <canvas id="watch-trend-chart"></canvas>
            </div>
        </div>
        
        <div class="history-grid" id="history-container">
            <!-- History items will be loaded here via JavaScript -->
        </div>
        
        <div class="empty-history" id="empty-history" style="display: none;">
            <div class="empty-state-icon">
                <i class="ph ph-popcorn"></i>
            </div>
            <h2>No Watch History Found</h2>
            <p>Your watched movies and TV shows will appear here.</p>
            <p>Watch content using a supported media player to have it added to your history.</p>
        </div>
        
        <div class="pagination" id="pagination">
            <button id="prev-page" class="page-btn" disabled><i class="ph ph-caret-left"></i> Previous</button>
            <span id="page-info">Page 1 of 1</span>
            <button id="next-page" class="page-btn" disabled>Next <i class="ph ph-caret-right"></i></button>
        </div>
    </div>
    
    <footer>
        <p>MPS for SIMKL | <a href="https://github.com/kavinthangavel/media-player-tracker-for-simkl" target="_blank"><i class="ph ph-github-logo"></i> GitHub</a></p>
        <p class="version">Version 1.0.0</p>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="script.js"></script>

    <div class="modal-backdrop" id="modal-backdrop"></div>
    
    <!-- Template for expanded card content -->
    <template id="expanded-content-template">
        <div class="poster-banner">
            <div class="poster-image"></div>
            <div class="movie-title-container">
                <h2 class="movie-title"></h2>
            </div>
        </div>
        <button class="close-button"><i class="ph ph-x"></i></button>
        <div class="expanded-content">
            <div class="expanded-details">
                <!-- Movie details section -->
                <div class="movie-details">
                    <div class="detail-group">
                        <div class="detail-label">Release Date</div>
                        <div class="detail-value" data-field="release_date">-</div>
                    </div>
                    <div class="detail-group">
                        <div class="detail-label">Runtime</div>
                        <div class="detail-value" data-field="runtime">-</div>
                    </div>
                    <!-- Removed Genres Detail Group -->
                </div>

                <!-- Technical details section -->
                <div class="tech-details">
                    <div class="detail-group">
                        <div class="detail-label">File Path</div>
                        <div class="detail-value" data-field="file_path">-</div>
                    </div>
                    <div class="detail-group">
                        <div class="detail-label">Resolution</div>
                        <div class="detail-value" data-field="resolution">-</div>
                    </div>
                    <div class="detail-group">
                        <div class="detail-label">File Size</div>
                        <div class="detail-value" data-field="file_size">-</div>
                    </div>
                </div>
            </div>
            
            <div class="detail-description">
                <div class="detail-label">Overview</div>
                <div class="detail-value" data-field="overview">-</div>
            </div>
            
            <!-- TV Show/Anime Episodes (only for TV/Anime) -->
            <div class="tv-details" style="display:none;">
                <div class="detail-label">Episodes Watched</div>
                <div class="detail-value" data-field="episodes_watched">-</div>
                
                <div class="detail-label">Episode List</div>
                <div class="episode-list" data-field="episode_list">
                    <!-- Episode items will be added dynamically -->
                </div>
                
                <div class="detail-group">
                    <div class="detail-label">Status</div>
                    <div class="detail-value" data-field="completion_status">-</div>
                </div>
            </div>

            <div class="expanded-actions"> <!-- Renamed class for consistency -->
                <button class="action-btn play-media">
                    <i class="ph ph-play-circle"></i> Play Media <!-- Changed Icon -->
                </button>
                <button class="action-btn secondary open-folder">
                    <i class="ph ph-folder-simple-open"></i> Open Folder <!-- Changed Icon -->
                </button>
                <button class="action-btn secondary open-simkl">
                    <i class="ph ph-link"></i> View on SIMKL <!-- Changed Icon -->
                </button>
            </div>
        </div>
    </template>
</body>
</html>